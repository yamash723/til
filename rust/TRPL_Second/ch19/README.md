Advanced Features
=======================

これまでで99%くらいは学習完了。残り1%をここと次のCh20でやる

生ポインタ
------------

```rust
let mut num = 5;
let r1 = &num as *const i32;
let r2 = &mut num as *mut i32;
```

* `*const T`/`*mut T`で生ポインタを取得することができる
* 束縛した変数を使用する際は`unsafe`ブロック内で使用しなければならない
* というよりそもそも生ポインタの利点が良く分かってないのが問題

unsage関数/メソッド
--------------------

* `unsafe`をつけることでunsafeな関数、メソッド、トレイトを定義できる
* unsafeな関数、メソッドはunsafeブロック内でしかコールできないことに注意

### 例

* 通常同一変数のmutableな多重参照は不可能
  * 1スライスをmutableな2スライスに分割する場合コンパイラに怒られる
    * `(&mut v[..3], &mut v[3..])`
  * ただこの分割が何も問題ないと理解しているので生ポインタを使用して直接分割する方法をとれる
    * `as_mut_ptr`で変更可能なメモリ領域を取得することができる
    * そこから得たメモリ領域から分割したい範囲を`slice::from_raw_parts_mut`を使用してスライス化
    * こういったやり方が可能

FFI
-------------

* 他言語のライブラリをrustで使用する(Foreign Function interface)場合、`extern`キーワードを使用する
* 同様に他言語から呼び出す関数を作成するときも`extern`使用する
  * この際`[no_mangle]`アノテーションを付与すること
    * コンパイル時に関数名の最適化を行わないようにするため

静的変数へのアクセス
--------------------

* `const`で定数、`static`で静的変数を宣言可能
  * `unsafe`を使用することで静的変数は書き換え可能となる

ライフタイムのサブタイピング
---------------------------

* `<'c, 's: 'c>`のような書き方をする事で`'s`は`'c`以上の寿命を持っているという記述ができる
* スライスを内包する構造体のパーサーがあるとき、「スライスはパーサーよりも長生き」でなければならない
  * とりあえず頭の中に入れておこう